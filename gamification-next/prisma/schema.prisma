// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("MONGO_URI")
}

model User {
  id              String       @id @default(auto()) @map("_id") @db.ObjectId
  username        String       @unique
  email           String       @unique
  password        String
  gender          String?      // Male or Female
  education_level String?      // O/L, A/L, HND, or Degree
  proficiency     String?      // School or High Education
  organization    String?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  assessments     Assessment[]
  gameResults     GameResult[]

  @@map("users")
}

model Assessment {
  id                    String   @id @default(auto()) @map("_id") @db.ObjectId
  userId                String   @db.ObjectId
  categoryId            String
  slug                  String
  answers               Int[]
  score                 Int
  percentage            Float
  knowledgeLevel        String   // Beginner, Intermediate, Advanced
  weakAreas             String[] // Categories where user scored low
  recommendedGames      String[] // Game slugs recommended based on weak areas
  attemptNumber         Int      @default(1)
  previousAttemptId     String?  @db.ObjectId
  previousScore         Int?
  improvement           Float?   // Percentage improvement from previous attempt
  mlRecommendations     String[] @default([]) // ML-based recommendations
  mlAwarenessLevel      String?  // ML predicted awareness level
  mlConfidence          Float?   // ML model confidence score
  detailedFeedback      Json?    // Store full feedback from ML model
  completedAt           DateTime @default(now())
  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, slug])
  @@index([userId, categoryId])
  @@map("assessments")
}

model GameResult {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @db.ObjectId
  category    String
  gameSlug    String
  preScore    Int
  gameScore   Int
  postScore   Int
  improvement Int
  completedAt DateTime
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, category])
  @@map("game_results")
}
